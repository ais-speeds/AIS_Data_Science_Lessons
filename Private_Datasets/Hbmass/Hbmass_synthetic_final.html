<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Sports Data Analytics Team, La Trobe University, Australia">
<meta name="dcterms.date" content="2023-08-29">

<title>Synthetic data generation from the Hbmass dataset using ‘synthpop’ in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Hbmass_synthetic_final_files/libs/clipboard/clipboard.min.js"></script>
<script src="Hbmass_synthetic_final_files/libs/quarto-html/quarto.js"></script>
<script src="Hbmass_synthetic_final_files/libs/quarto-html/popper.min.js"></script>
<script src="Hbmass_synthetic_final_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Hbmass_synthetic_final_files/libs/quarto-html/anchor.min.js"></script>
<link href="Hbmass_synthetic_final_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Hbmass_synthetic_final_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Hbmass_synthetic_final_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Hbmass_synthetic_final_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Hbmass_synthetic_final_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Synthetic data generation from the Hbmass dataset using ‘synthpop’ in R</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Sports Data Analytics Team, La Trobe University, Australia </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 29, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<div class="cell">
<style type="text/css">
.justify {
  text-align: justify !important
}
</style>
</div>
<section id="introduction" class="level2 justify">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Synthetic data sets are algorithmically produced replicas of real-world data, designed to closely mimic the statistical properties of the original information while ensuring people’s confidentiality. In an era where data-driven decisions are pivotal yet privacy concerns are paramount, finding a balance between useful insight and anonymity is crucial. Synthetic data serves as this balancing solution. In sports, it enables coaches, analysts, exercise scientists, and physiologists to study trends in performance, physical metrics, and injury rates without jeopardizing individual athlete identities. This approach offers a secure platform for developing new training regimes, analyzing game strategies, and even scouting, all while meeting strict data protection standards. Overall, synthetic data stands as a powerful tool for harnessing the advantages of data analysis in sports, without compromising the privacy and confidentiality that athletes and organizations demand.</p>
<p><strong>NOTE:</strong> The processes of missing data imputation, synthetic data generation, and model-based evaluation involve random computations. As such, the exact metrics and results you see might vary each time you run the code. To achieve consistent results across multiple runs, the code includes set.seed() functions before each step involving randomness. Make sure to run these set.seed() lines if you wish to replicate the outcomes within your own environment. This tutorial has been produced with R version 4.3.0.</p>
</section>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>my_seed <span class="ot">=</span> <span class="dv">124</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="data-import-and-exploration" class="level2 justify">
<h2 class="anchored" data-anchor-id="data-import-and-exploration">Data import and exploration</h2>
<p>We start by loading all the necessary libraries and reading the data from the Hbmass Excel file.</p>
<section id="data-import" class="level3">
<h3 class="anchored" data-anchor-id="data-import">Data import</h3>
</section>
</section>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load required libraries</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(naniar)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mice)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(synthpop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Reading the Hbmass Excel file and selecting the data sheet</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>sheets <span class="ot">&lt;-</span> <span class="fu">excel_sheets</span>(<span class="st">"./AHBM_Data.xlsx"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>real_data <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"./AHBM_Data.xlsx"</span>, <span class="at">sheet=</span><span class="st">"AHBM_LONG"</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an exact copy of the 'real_data' data frame (this might come handy later)</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>real_data_copy <span class="ot">&lt;-</span> real_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="initial-data-exploration" class="level3 justify">
<h3 class="anchored" data-anchor-id="initial-data-exploration">Initial data exploration</h3>
<p>To gain an understanding of the loaded data set, we first conduct an initial exploration of the data.</p>
<ul>
<li><p>Descriptive Statistics: Our first step is to examine a summary of key statistical measures. This provides essential insights into central tendencies, data ranges, and other statistical characteristics.</p></li>
<li><p>Pairwise Scatter Plots: Subsequently, we visualize how variables interact with each other through scatter plots, which can reveal linear or non-linear relationships.</p></li>
<li><p>Histograms: Next, we study the distribution of each variable using histograms. This step helps us identify patterns, such as skewness or normality.</p></li>
<li><p>Correlation Matrix: Last but not least, we compute and visualize a correlation matrix. Correlation measures the strength and direction of the linear relationship between two variables. The values range from -1 to 1, where -1 indicates a perfect negative correlation, 1 indicates a perfect positive correlation, and 0 indicates no linear correlation. The size and color of the circles in this matrix signifies the strength and direction of correlations between variables.</p></li>
</ul>
</section>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Descriptive statistics</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(real_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       ID             TIME          SEX            SUP_DOSE           BM      
 Min.   :  1.0   Min.   :0.0   Min.   :0.0000   Min.   :0.000   Min.   :47.0  
 1st Qu.: 45.0   1st Qu.:0.0   1st Qu.:0.0000   1st Qu.:1.000   1st Qu.:59.0  
 Median : 89.5   Median :0.5   Median :1.0000   Median :1.000   Median :65.7  
 Mean   : 89.5   Mean   :0.5   Mean   :0.5506   Mean   :1.022   Mean   :66.4  
 3rd Qu.:134.0   3rd Qu.:1.0   3rd Qu.:1.0000   3rd Qu.:1.000   3rd Qu.:73.0  
 Max.   :178.0   Max.   :1.0   Max.   :1.0000   Max.   :2.000   Max.   :97.4  
                                                                              
      FER               FE             TSAT           TRANS      
 Min.   : 11.80   Min.   : 5.80   Min.   : 3.10   Min.   :1.300  
 1st Qu.: 43.40   1st Qu.:13.57   1st Qu.:20.00   1st Qu.:2.475  
 Median : 65.35   Median :17.50   Median :26.00   Median :2.700  
 Mean   : 74.58   Mean   :19.68   Mean   :28.05   Mean   :2.767  
 3rd Qu.: 98.53   3rd Qu.:24.05   3rd Qu.:34.25   3rd Qu.:3.100  
 Max.   :227.80   Max.   :78.30   Max.   :88.00   Max.   :4.400  
 NA's   :56       NA's   :104     NA's   :104     NA's   :104    
      AHBM             RHBM      
 Min.   : 478.0   Min.   : 8.20  
 1st Qu.: 700.8   1st Qu.:11.50  
 Median : 848.5   Median :13.20  
 Mean   : 857.6   Mean   :12.88  
 3rd Qu.: 977.2   3rd Qu.:14.40  
 Max.   :1424.0   Max.   :17.10  
                                 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pairwise Scatter plots</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>cont_var_cols <span class="ot">&lt;-</span> real_data[, <span class="fu">c</span>(<span class="st">"BM"</span>, <span class="st">"FER"</span>, <span class="st">"FE"</span>, <span class="st">"TSAT"</span>, <span class="st">"TRANS"</span>, <span class="st">"AHBM"</span>, <span class="st">"RHBM"</span>)] <span class="co"># continuous variables columns</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(cont_var_cols, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">cex =</span> <span class="fl">0.6</span>) <span class="co"># pch - plotting character, cex - character expansion</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Hbmass_synthetic_final_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Distributions</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame to store variable names and bin widths</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>cont_var_distrib <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">var =</span> <span class="fu">c</span>(<span class="st">"BM"</span>, <span class="st">"FER"</span>, <span class="st">"FE"</span>, <span class="st">"TSAT"</span>, <span class="st">"TRANS"</span>, <span class="st">"AHBM"</span>, <span class="st">"RHBM"</span>),</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">bin_width =</span> <span class="fu">c</span>(<span class="fl">1.5</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="fl">0.1</span>, <span class="dv">25</span>, <span class="fl">0.2</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through the data frame to create plots</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(cont_var_distrib)) {</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  var_name <span class="ot">&lt;-</span> <span class="fu">as.character</span>(cont_var_distrib[i, <span class="st">"var"</span>])</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  bin_w <span class="ot">&lt;-</span> cont_var_distrib[i, <span class="st">"bin_width"</span>]</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(real_data, <span class="fu">aes_string</span>(<span class="at">x =</span> var_name)) <span class="sc">+</span> </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> bin_w, <span class="at">fill =</span> <span class="st">"skyblue"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Distribution of"</span>, var_name))</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(p)</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Hbmass_synthetic_final_files/figure-html/unnamed-chunk-5-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Hbmass_synthetic_final_files/figure-html/unnamed-chunk-5-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Hbmass_synthetic_final_files/figure-html/unnamed-chunk-5-4.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Hbmass_synthetic_final_files/figure-html/unnamed-chunk-5-5.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Hbmass_synthetic_final_files/figure-html/unnamed-chunk-5-6.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Hbmass_synthetic_final_files/figure-html/unnamed-chunk-5-7.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Hbmass_synthetic_final_files/figure-html/unnamed-chunk-5-8.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation Matrix</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>cor_matrix <span class="ot">&lt;-</span> <span class="fu">cor</span>(cont_var_cols, <span class="at">use =</span> <span class="st">"complete.obs"</span>)  <span class="co"># "complete.obs" means that only complete observations (rows where no variables have missing values) will be used in the calculations</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(cor_matrix, <span class="at">method =</span> <span class="st">"circle"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Hbmass_synthetic_final_files/figure-html/unnamed-chunk-5-9.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="data-missingness" class="level3 justify">
<h3 class="anchored" data-anchor-id="data-missingness">Data missingness</h3>
<p>Before we proceed with generating synthetic data with <code>synthpop</code>, it’s really important to check for missing values in the data set. How we deal with missing data can make a big difference in the quality of our synthetic data set. Before imputing or handling missing values, it’s essential to understand the nature of the missingness. We first check if there are any missing values in our data set at all. And if there are any, we visualize where they are in our data set using the <code>vis_miss()</code> function.</p>
</section>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(real_data)) <span class="co"># check how many missing values there are in the data set</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 368</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vis_miss</span>(real_data) <span class="co"># visualize the missingness in the dataset</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Hbmass_synthetic_final_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="imputation-of-missing-values" class="level2 justify">
<h2 class="anchored" data-anchor-id="imputation-of-missing-values">Imputation of missing values</h2>
<p>From the missingness visualization above, we see that variables <code>FER</code>, <code>FE</code>, <code>TSAT</code>, and <code>TRANS</code> have some values missing. Moreover, there is some structure to the missing data that exhibits the following pattern:</p>
<ul>
<li><p>if <strong><code>FE</code></strong>, <strong><code>TSAT</code></strong>, and <strong><code>TRANS</code></strong> are missing, then <strong><code>FER</code></strong> can also occasionally be missing;</p></li>
<li><p>if <strong><code>FER</code></strong> is missing, <strong><code>FE</code></strong>, <strong><code>TSAT</code></strong>, and <strong><code>TRANS</code></strong> are never fully observed in those rows.</p></li>
</ul>
<p>The pattern above and the fact that <strong><code>FE</code></strong>, <strong><code>TSAT</code></strong>, and <strong><code>TRANS</code></strong> share all rows of missing data suggests a Missing at Random (MAR) mechanism of missingness, at least for these columns. Moreover, the missingness pattern might indicate a hierarchical or dependent relationship between <strong><code>FER</code></strong> and the other three columns, as it seems like the presence of values in <strong><code>FER</code></strong> might be a prerequisite for the presence of values in <strong><code>FE</code></strong>, <strong><code>TSAT</code></strong>, and <strong><code>TRANS</code></strong>.</p>
<p>When the data has structured missingness of MAR type, simple imputation techniques like replacing with mean, median, or mode are often insufficient. These simpler methods do not account for the relationships between variables or the patterns of missingness. That’s why model-based imputation methods like MICE (Multivariate Imputation by Chained Equations) are more appropriate in such cases.</p>
<p>MICE is a robust technique designed to handle complex missing data patterns. Rather than filling in a single value for each missing entry, MICE iteratively updates these values based on a series of regression models that consider other variables in the data. This iterative process is typically run until it converges to stable solutions.</p>
<p>Here’s the process in a nutshell:</p>
<ul>
<li><p>Initially, missing values are replaced with simple placeholders (e.g., column mean).</p></li>
<li><p>For each variable with missing values, a regression model is fitted where this variable is the dependent variable, and all other variables act as independent variables.</p></li>
<li><p>Missing values are then updated with predictions from the respective regression model.</p></li>
<li><p>This process is repeated iteratively until the imputed values stabilize.</p></li>
</ul>
<p>For continuous variables, Predictive Mean Matching (PMM) is often a method of choice within the MICE framework. PMM works by imputing missing values based on observed data points that have similar predicted values. This preserves the data distribution and relationships between variables.</p>
<p>In brief, PMM:</p>
<ul>
<li><p>Identifies a set of observed values whose predicted values are closest to the predicted value for the missing entry.</p></li>
<li><p>Randomly picks one from this set to impute the missing value.</p></li>
</ul>
<p>By employing MICE with PMM, we can handle missing data effectively while preserving the complex relationships between variables in the original dataset.</p>
<p>In this section, we are using the <code>mice</code> package in R to handle missing values in the FER, FE, TSAT, and TRANS variables. Leveraging the robustness of MICE, we apply the PMM method for these continuous variables to capture the underlying relationships between them.</p>
<section id="predictor-matrix" class="level3">
<h3 class="anchored" data-anchor-id="predictor-matrix">Predictor matrix</h3>
<p>A predictor matrix is a tool used in the <code>mice</code> package to decide which variables in the dataset will be used to estimate missing values for other variables. In this matrix, each row represents a variable with missing data, and each column represents a possible predictor variable. A value of <code>1</code> means the column variable (predictor) will be used to estimate missing values in the row’s variable, while a value of <strong><code>0</code></strong> means it won’t be used. Typically, the diagonal of this matrix is set to <code>0</code>, meaning a variable doesn’t predict itself.</p>
<p>By default, when constructing a predictor matrix in <code>mice</code>, every variable is initially considered as a potential predictor for all other variables. However, <code>mice</code> allows the flexibility to adjust this. In our case, we ensure that variables <code>FER</code>, <code>FE</code>, <code>TSAT</code>, and <code>TRANS</code> are imputed using all other variables as predictors, while explicitly excluding the <code>ID</code> variable from the process.</p>
</section>
</section>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate an initial predictor matrix using quickpred function from the mice package</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>predictor_matrix <span class="ot">&lt;-</span> mice<span class="sc">::</span><span class="fu">quickpred</span>(real_data)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the initial predictor matrix for inspection</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(predictor_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         ID TIME SEX SUP_DOSE BM FER FE TSAT TRANS AHBM RHBM
ID        0    0   0        0  0   0  0    0     0    0    0
TIME      0    0   0        0  0   0  0    0     0    0    0
SEX       0    0   0        0  0   0  0    0     0    0    0
SUP_DOSE  0    0   0        0  0   0  0    0     0    0    0
BM        0    0   0        0  0   0  0    0     0    0    0
FER       1    1   1        1  1   0  0    1     1    1    1
FE        1    1   1        1  0   0  0    1     1    1    0
TSAT      0    1   1        1  0   1  1    0     1    0    0
TRANS     1    1   1        1  1   1  1    1     0    1    1
AHBM      0    0   0        0  0   0  0    0     0    0    0
RHBM      0    0   0        0  0   0  0    0     0    0    0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set predictor flags for columns ("FER", "FE", "TSAT", "TRANS") to 1, indicating they will be used for imputation.</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>predictor_matrix[<span class="fu">c</span>(<span class="st">"FER"</span>, <span class="st">"FE"</span>, <span class="st">"TSAT"</span>, <span class="st">"TRANS"</span>), ] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Exclude "ID" from the predictor matrix by setting its flag to 0</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>vars_to_exclude <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ID"</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>predictor_matrix[, vars_to_exclude] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the diagonal of the predictor matrix to 0, indicating that each variable should not predict itself</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>(predictor_matrix) <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the modified predictor matrix for final inspection</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(predictor_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         ID TIME SEX SUP_DOSE BM FER FE TSAT TRANS AHBM RHBM
ID        0    0   0        0  0   0  0    0     0    0    0
TIME      0    0   0        0  0   0  0    0     0    0    0
SEX       0    0   0        0  0   0  0    0     0    0    0
SUP_DOSE  0    0   0        0  0   0  0    0     0    0    0
BM        0    0   0        0  0   0  0    0     0    0    0
FER       0    1   1        1  1   0  1    1     1    1    1
FE        0    1   1        1  1   1  0    1     1    1    1
TSAT      0    1   1        1  1   1  1    0     1    1    1
TRANS     0    1   1        1  1   1  1    1     0    1    1
AHBM      0    0   0        0  0   0  0    0     0    0    0
RHBM      0    0   0        0  0   0  0    0     0    0    0</code></pre>
</div>
</div>
<section id="data-imputation-with-mice" class="level3 justify">
<h3 class="anchored" data-anchor-id="data-imputation-with-mice">Data imputation with MICE</h3>
<p>Once the predictor matrix has been constructed, we create a vector to specify which imputation methods to be used for each variable. For our target variables <code>FER</code>, <code>FE</code>, <code>TSAT</code>, <code>TRANS</code> we set the method to PMM. This approach uses all variables as predictors (excluding <code>ID</code>) but specifically applies PMM only to our target variables, allowing us to benefit from the predictive power of the entire data set. A random seed is established for reproducibility of the imputation output.</p>
</section>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize a vector of empty strings, the length is the number of columns in the dataset</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>default_methods <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">""</span>, <span class="fu">ncol</span>(real_data))  </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Name the vector elements with the names of the columns in real_data</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(default_methods) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(real_data)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify the PMM imputation method for the variables to be imputed</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>default_methods[<span class="fu">c</span>(<span class="st">"FER"</span>, <span class="st">"FE"</span>, <span class="st">"TSAT"</span>, <span class="st">"TRANS"</span>)] <span class="ot">&lt;-</span> <span class="st">"pmm"</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Set seed for reproducibility</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(my_seed)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Run MICE to perform multiple imputations: m=5 is the number of imputed datasets, maxit=50 is maximum iterations</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>imputed_data <span class="ot">&lt;-</span> mice<span class="sc">::</span><span class="fu">mice</span>(real_data, <span class="at">m =</span> <span class="dv">5</span>, <span class="at">method =</span> default_methods, <span class="at">predictorMatrix =</span> predictor_matrix, <span class="at">maxit =</span> <span class="dv">50</span>)</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="co"># View the final predictor matrix</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(imputed_data<span class="sc">$</span>predictorMatrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="evaluating-mice-imputed-data-quality" class="level3 justify">
<h3 class="anchored" data-anchor-id="evaluating-mice-imputed-data-quality">Evaluating MICE imputed data quality</h3>
<p>After imputing the missing values, it’s essential to validate the output. To ensure that the imputed data accurately reflects relationships and structures of the original data set, we perform several checks. These include verifying the hierarchical structure, comparing the distributions of the original and imputed data, assessing correlations, and contrasting the value ranges in both the original and imputed data sets.</p>
<section id="verify-hierarchical-structure" class="level4">
<h4 class="anchored" data-anchor-id="verify-hierarchical-structure">Verify hierarchical structure</h4>
<p>If the hierarchical structure is maintained, the check below should return 0. This means that the imputation has respected the hierarchical structure of the original data set.</p>
</section>
</section>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>completed_data_subset <span class="ot">&lt;-</span> <span class="fu">complete</span>(imputed_data, <span class="dv">1</span>)[, <span class="fu">c</span>(<span class="st">"FER"</span>, <span class="st">"FE"</span>, <span class="st">"TSAT"</span>, <span class="st">"TRANS"</span>)] <span class="co"># Extract one of the imputed datasets and select only the target variables</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure that there are no rows where FER is missing and the other three columns (FE, TSAT, TRANS) are observed</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(completed_data_subset<span class="sc">$</span>FER) <span class="sc">&amp;</span> (<span class="sc">!</span><span class="fu">is.na</span>(completed_data_subset<span class="sc">$</span>FE) <span class="sc">|</span> <span class="sc">!</span><span class="fu">is.na</span>(completed_data_subset<span class="sc">$</span>TSAT) <span class="sc">|</span> <span class="sc">!</span><span class="fu">is.na</span>(completed_data_subset<span class="sc">$</span>TRANS)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<section id="distributions-check" class="level4 justify">
<h4 class="anchored" data-anchor-id="distributions-check">Distributions check</h4>
<p>To evaluate the quality of our imputed data, we visualize and compare the distributions of imputed and observed values for each variable. Ideally, the distributions should match closely, indicating that the imputation process has successfully preserved the data’s original characteristics without introducing significant biases.</p>
</section>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a subset of the original data that contains only the variables with imputed values</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>subset_real_data <span class="ot">&lt;-</span> real_data[, <span class="fu">c</span>(<span class="st">"FER"</span>, <span class="st">"FE"</span>, <span class="st">"TSAT"</span>, <span class="st">"TRANS"</span>)]</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame for variables that have imputed values to store the variable names and bin widths</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>cont_var_distrib <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">var =</span> <span class="fu">c</span>(<span class="st">"FER"</span>, <span class="st">"FE"</span>, <span class="st">"TSAT"</span>, <span class="st">"TRANS"</span>),</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">bin_width =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="fl">0.1</span>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>) <span class="co"># continuous variables distributions</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through the data frame to create plots</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(cont_var_distrib)) {</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  var_name <span class="ot">&lt;-</span> <span class="fu">as.character</span>(cont_var_distrib[i, <span class="st">"var"</span>])</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>  bin_w <span class="ot">&lt;-</span> cont_var_distrib[i, <span class="st">"bin_width"</span>]</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">data =</span> completed_data_subset, <span class="fu">aes_string</span>(<span class="at">x =</span> var_name), <span class="at">binwidth =</span> bin_w, <span class="at">fill =</span> <span class="st">"red"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">position =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">data =</span> subset_real_data, <span class="fu">aes_string</span>(<span class="at">x =</span> var_name), <span class="at">binwidth =</span> bin_w, <span class="at">fill =</span> <span class="st">"blue"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">position =</span> <span class="st">"identity"</span>) <span class="sc">+</span> </span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Distribution of"</span>, var_name, <span class="st">": Imputed (Red) vs. Observed (Blue)"</span>))</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Setting 'position = "identity"' allows the histograms to overlap, facilitating easy comparison</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(p)</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Hbmass_synthetic_final_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Hbmass_synthetic_final_files/figure-html/unnamed-chunk-10-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Hbmass_synthetic_final_files/figure-html/unnamed-chunk-10-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Hbmass_synthetic_final_files/figure-html/unnamed-chunk-10-4.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="correlations-check" class="level4 justify">
<h4 class="anchored" data-anchor-id="correlations-check">Correlations Check</h4>
<p>To make sure the relationships between variables in the imputed data are consistent with the original data, we compare the correlation matrices — one from the original data and one from the imputed data. The correlations don’t have to match exactly, but they should be reasonably close. We visualize these using correlation plots, where circle size and color represent the strength and direction of the correlation, respectively. If the plots look reasonably similar, it suggests that the imputation has preserved the relationships between variables. If there are significant differences, it might be a sign to investigate further or consider alternative imputation methods or parameters.</p>
</section>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare the correlation matrices to ensure that the relationships between variables in the imputed data are consistent with the original data</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>cor_matrix_imputed <span class="ot">&lt;-</span> <span class="fu">cor</span>(completed_data_subset, <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>cor_matrix_original <span class="ot">&lt;-</span> <span class="fu">cor</span>(subset_real_data, <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># View the correlation matrices</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cor_matrix_imputed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               FER          FE       TSAT      TRANS
FER    1.000000000 0.009181825  0.1580852 -0.3080575
FE     0.009181825 1.000000000  0.6839611  0.1524052
TSAT   0.158085229 0.683961088  1.0000000 -0.2273167
TRANS -0.308057485 0.152405195 -0.2273167  1.0000000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cor_matrix_original)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               FER          FE       TSAT      TRANS
FER    1.000000000 0.002723024  0.1431203 -0.2641657
FE     0.002723024 1.000000000  0.7088081  0.1384340
TSAT   0.143120333 0.708808074  1.0000000 -0.2131533
TRANS -0.264165721 0.138433992 -0.2131533  1.0000000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize the correlations in the original data</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(cor_matrix_original, <span class="at">title =</span> <span class="st">"Original Data"</span>, <span class="at">method =</span> <span class="st">"circle"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Hbmass_synthetic_final_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize the correlations in the imputed data</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(cor_matrix_imputed, <span class="at">title =</span> <span class="st">"Imputed Data"</span>, <span class="at">method =</span> <span class="st">"circle"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Hbmass_synthetic_final_files/figure-html/unnamed-chunk-11-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="justify">
<p>Both the original and imputed data show similar correlation patterns among the target variables, suggesting that the imputation has preserved the relationships between variables to a large extent.</p>
<section id="assessing-value-range-consistency" class="level4">
<h4 class="anchored" data-anchor-id="assessing-value-range-consistency">Assessing value range consistency</h4>
<p>It’s a good practice to ensure that the imputed values fall within a reasonable range, especially when compared to the original data. By comparing the “Original_Min” and “Original_Max” rows to the “Imputed_Min” and “Imputed_Max” rows, we check that the imputed values for each variable fall within the expected range.</p>
</section>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the range of values for each variable in the original data, ignoring NA values</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>original_ranges <span class="ot">&lt;-</span> <span class="fu">sapply</span>(subset_real_data, range, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the range of values for each variable in the imputed data, ignoring NA values</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>imputed_ranges <span class="ot">&lt;-</span> <span class="fu">sapply</span>(completed_data_subset, range, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the ranges from both original and imputed data into a single data frame for easy comparison</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>ranges_df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(original_ranges, imputed_ranges)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename the rows for clarity and print the output</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(ranges_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Original_Min"</span>, <span class="st">"Original_Max"</span>, <span class="st">"Imputed_Min"</span>, <span class="st">"Imputed_Max"</span>)</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ranges_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               FER   FE TSAT TRANS
Original_Min  11.8  5.8  3.1   1.3
Original_Max 227.8 78.3 88.0   4.4
Imputed_Min   11.8  5.8  3.1   1.3
Imputed_Max  227.8 78.3 88.0   4.4</code></pre>
</div>
</div>
<section id="replacing-missing-original-data-with-imputed-columns" class="level3 justify">
<h3 class="anchored" data-anchor-id="replacing-missing-original-data-with-imputed-columns">Replacing missing original data with imputed columns</h3>
<p>Now we are ready to merge the imputed data with the original data set. After this step, the original data set <strong><code>real_data</code></strong> will no longer have any missing values in the columns <strong><code>FER</code></strong>, <strong><code>FE</code></strong>, <strong><code>TSAT</code></strong>, and <strong><code>TRANS</code></strong>.</p>
</section>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace the columns with missing values in the original dataset with the imputed ones</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>real_data[, <span class="fu">c</span>(<span class="st">"FER"</span>, <span class="st">"FE"</span>, <span class="st">"TSAT"</span>, <span class="st">"TRANS"</span>)] <span class="ot">&lt;-</span> completed_data_subset[, <span class="fu">c</span>(<span class="st">"FER"</span>, <span class="st">"FE"</span>, <span class="st">"TSAT"</span>, <span class="st">"TRANS"</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="synthetic-data-generation" class="level2 justify">
<h2 class="anchored" data-anchor-id="synthetic-data-generation">Synthetic data generation</h2>
<p>To generate high-quality synthetic data, the original dataset must first be adequately prepared. This preparation could entail handling missing values, encoding categorical variables, and normalizing numerical ones. In our case, the only necessary preprocessing was the management of missing values. With that task completed, we’re ready to generate synthetic data that mirrors the characteristics of the original data set. The <code>synthpop</code> package in R allows us to generate synthetic data that maintains the statistical attributes of the original set without exposing any sensitive information.</p>
<p>In the synthetic data generation process using the <code>synthpop</code> package, the data type of each variable is crucial. In our data set, the variables <code>TIME,</code> <code>SEX</code>, and <code>SUP_DOSE</code> are categorical but have numerical values with either two or three levels. To ensure <code>synthpop</code> recognizes them as categorical, we convert these variables into factors using the <code>as.factor()</code> function in R.</p>
<p>We then define the ‘visit sequence’ via the <code>visit.sequence</code> parameter. This sequence, comprising the order in which variables are synthesized, is essential because a variable can only be predicted by those synthesized earlier in the sequence. In our R code, we specify the <code>visit.sequence</code> such that <code>TIME</code> comes first, followed by <code>SEX,</code> <code>SUP_DOSE</code> and so on.</p>
<p>The <code>method</code> parameter specifies how each variable is synthesized. For the variables <code>TIME,</code> <code>SEX</code>, and <code>SUP_DOSE</code> we use the ‘sample’ method. This is because they are the first in the visit sequence and do not have preceding predictors. These variables’ synthetic values are obtained through random sampling with replacement from the original data. We intentionally avoid using the ‘cart’ method for these variables to retain their original distributions.</p>
<p>For all other variables, the ‘cart’ (Classification and Regression Trees) method is used. This is the default method for variables with preceding predictors in the <code>visit.sequence</code>.</p>
<p>The <code>predictor.matrix</code> defines which variables act as predictors for each target variable. A <code>1</code> in this matrix indicates the column variable will be a predictor for the row variable. Initially, we let <code>syn()</code> create a default predictor matrix. However, we manually adjust this matrix to ensure that variables like <code>TIME,</code> <code>SEX</code>, and <code>SUP_DOSE</code> are also used as predictors for other variables in the synthetic data.</p>
<p>Variables with an empty method (<strong><code>""</code></strong>) in the <code>method</code> parameter are neither synthesized nor used as predictors. This ensures that they are excluded from the synthesis process altogether, but their original values are kept in the synthetic data.</p>
<p>After setting up these configurations, we run the <code>syn()</code> function again, but with our manually adjusted predictor matrix. This ensures that the synthetic data reflects the relationships and distributions found in the original data set, while also safeguarding any sensitive information.</p>
<p>Overall, synthetic data generation is a multistep, configurable process that aims to produce data that statistically mirrors the original data set.</p>
</section>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fix the pseudo random number generator seed and make the results reproducible</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>my.seed <span class="ot">&lt;-</span> my_seed</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert 'TIME' to factor</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>real_data<span class="sc">$</span>TIME <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(real_data<span class="sc">$</span>TIME)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert 'SEX' to factor</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>real_data<span class="sc">$</span>SEX <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(real_data<span class="sc">$</span>SEX)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert 'SUP_DOSE' to factor</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>real_data<span class="sc">$</span>SUP_DOSE <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(real_data<span class="sc">$</span>SUP_DOSE)</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the structure of the data frame to confirm the conversion</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="co"># As you can see from the table below, variables  TIME, SEX, and SUP_DOSE have been converted into factors</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(real_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [356 × 11] (S3: tbl_df/tbl/data.frame)
 $ ID      : num [1:356] 1 2 3 4 5 6 7 8 9 10 ...
 $ TIME    : Factor w/ 2 levels "0","1": 1 1 1 1 1 1 1 1 1 1 ...
 $ SEX     : Factor w/ 2 levels "0","1": 2 2 1 2 2 1 2 2 2 2 ...
 $ SUP_DOSE: Factor w/ 3 levels "0","1","2": 1 1 1 1 1 1 1 1 1 1 ...
 $ BM      : num [1:356] 77.1 65.4 53 63.5 60.2 59.2 65.7 67.9 75.1 61.5 ...
 $ FER     : num [1:356] 161 169 228 202 176 ...
 $ FE      : num [1:356] 22.1 15.3 17.5 14.4 25.3 ...
 $ TSAT    : num [1:356] 36 25 31 22 36 39 25 9 26 30 ...
 $ TRANS   : num [1:356] 2.7 2.7 2.5 2.9 2.6 2.4 3.1 3.4 2.7 2.4 ...
 $ AHBM    : num [1:356] 1005 876 782 909 744 ...
 $ RHBM    : num [1:356] 13 13.4 14.8 14.3 12.4 12.4 13.8 12.9 14.6 14 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the initial visit sequence and methods for synthesis</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>visit.sequence.ini <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>method.ini <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="st">"sample"</span>, <span class="st">"sample"</span>, <span class="st">"sample"</span>, <span class="st">"cart"</span>, <span class="st">"cart"</span>, <span class="st">"cart"</span>, <span class="st">"cart"</span>, <span class="st">"cart"</span>, <span class="st">"cart"</span>, <span class="st">""</span>)  <span class="co">#polyreg</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Run initial synthesis</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co"># You'll see a warning "Method "cart" is not valid for a variable without predictors (BM) Method has been changed to "sample" ". This is normal as, according to the default predictor matrix, variable BM doesn't have predictors yet, and therefore method 'cart' can't be used for this variable. This is fixed below where we adjust the predictor matrix. </span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>synth_data.ini <span class="ot">&lt;-</span> <span class="fu">syn</span>(<span class="at">data =</span> real_data, <span class="at">visit.sequence =</span> visit.sequence.ini, <span class="at">method =</span> method.ini, <span class="at">m =</span> <span class="dv">0</span>, <span class="at">drop.not.used =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Method "cart" is not valid for a variable without predictors (BM)
Method has been changed to "sample"


Variable(s): ID, TIME, SEX, SUP_DOSE, RHBM not synthesised or used in prediction.
CAUTION: The synthesised data will contain the variable(s) unchanged.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the default predictor matrix</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>synth_data.ini<span class="sc">$</span>predictor.matrix</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         ID TIME SEX SUP_DOSE BM FER FE TSAT TRANS AHBM RHBM
ID        0    0   0        0  0   0  0    0     0    0    0
TIME      0    0   0        0  0   0  0    0     0    0    0
SEX       0    0   0        0  0   0  0    0     0    0    0
SUP_DOSE  0    0   0        0  0   0  0    0     0    0    0
BM        0    0   0        0  0   0  0    0     0    0    0
FER       0    0   0        0  1   0  0    0     0    0    0
FE        0    0   0        0  1   1  0    0     0    0    0
TSAT      0    0   0        0  1   1  1    0     0    0    0
TRANS     0    0   0        0  1   1  1    1     0    0    0
AHBM      0    0   0        0  1   1  1    1     1    0    0
RHBM      0    0   0        0  0   0  0    0     0    0    0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Customize the predictor matrix</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>predictor.matrix.corrected <span class="ot">&lt;-</span> synth_data.ini<span class="sc">$</span>predictor.matrix</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>rows_to_change <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"TIME"</span>, <span class="st">"SEX"</span>, <span class="st">"SUP_DOSE"</span>, <span class="st">"BM"</span>, <span class="st">"FER"</span>, <span class="st">"FE"</span>, <span class="st">"TSAT"</span>, <span class="st">"TRANS"</span>, <span class="st">"AHBM"</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>cols_to_change <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"TIME"</span>, <span class="st">"SEX"</span>, <span class="st">"SUP_DOSE"</span>, <span class="st">"BM"</span>, <span class="st">"FER"</span>, <span class="st">"FE"</span>, <span class="st">"TSAT"</span>, <span class="st">"TRANS"</span>, <span class="st">"AHBM"</span>)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>predictor.matrix.corrected[rows_to_change, cols_to_change] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>(predictor.matrix.corrected) <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>predictor.matrix.corrected</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         ID TIME SEX SUP_DOSE BM FER FE TSAT TRANS AHBM RHBM
ID        0    0   0        0  0   0  0    0     0    0    0
TIME      0    0   1        1  1   1  1    1     1    1    0
SEX       0    1   0        1  1   1  1    1     1    1    0
SUP_DOSE  0    1   1        0  1   1  1    1     1    1    0
BM        0    1   1        1  0   1  1    1     1    1    0
FER       0    1   1        1  1   0  1    1     1    1    0
FE        0    1   1        1  1   1  0    1     1    1    0
TSAT      0    1   1        1  1   1  1    0     1    1    0
TRANS     0    1   1        1  1   1  1    1     0    1    0
AHBM      0    1   1        1  1   1  1    1     1    0    0
RHBM      0    0   0        0  0   0  0    0     0    0    0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate synthetic data using the corrected predictor matrix</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="co"># You may encounter warnings like "Not synthesised predictor FER removed from predictor.matrix for variable BM." This is expected behavior. Variables are synthesized one-by-one and can't serve as predictors until they've been synthesized. As a result, only the last variable to be synthesized, AHBM, doesn't produce this warning because all its predictors have already been synthesized by that point.</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>synth_data.corrected <span class="ot">&lt;-</span> <span class="fu">syn</span>(<span class="at">data =</span> real_data, <span class="at">visit.sequence =</span> visit.sequence.ini, <span class="at">method =</span> method.ini, <span class="at">predictor.matrix =</span> predictor.matrix.corrected, <span class="at">seed =</span> my.seed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Not synthesised predictor FER removed from predictor.matrix for variable BM.
 Not synthesised predictor FE removed from predictor.matrix for variable BM.
 Not synthesised predictor FE removed from predictor.matrix for variable FER.
 Not synthesised predictor TSAT removed from predictor.matrix for variable BM.
 Not synthesised predictor TSAT removed from predictor.matrix for variable FER.
 Not synthesised predictor TSAT removed from predictor.matrix for variable FE.
 Not synthesised predictor TRANS removed from predictor.matrix for variable BM.
 Not synthesised predictor TRANS removed from predictor.matrix for variable FER.
 Not synthesised predictor TRANS removed from predictor.matrix for variable FE.
 Not synthesised predictor TRANS removed from predictor.matrix for variable TSAT.
 Not synthesised predictor AHBM removed from predictor.matrix for variable BM.
 Not synthesised predictor AHBM removed from predictor.matrix for variable FER.
 Not synthesised predictor AHBM removed from predictor.matrix for variable FE.
 Not synthesised predictor AHBM removed from predictor.matrix for variable TSAT.
 Not synthesised predictor AHBM removed from predictor.matrix for variable TRANS.

Variable(s): ID, RHBM not synthesised or used in prediction.
CAUTION: The synthesised data will contain the variable(s) unchanged.


Synthesis
-----------
 BM FER FE TSAT TRANS AHBM</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Update 'RHBM' values in synthetic data</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>synth_data.corrected<span class="sc">$</span>syn<span class="sc">$</span>RHBM <span class="ot">&lt;-</span> synth_data.corrected<span class="sc">$</span>syn<span class="sc">$</span>AHBM <span class="sc">/</span> synth_data.corrected<span class="sc">$</span>syn<span class="sc">$</span>BM</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Final synthetic data</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>synth_data <span class="ot">&lt;-</span> synth_data.corrected<span class="sc">$</span>syn</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="synthetic-data-evaluation" class="level2 justify">
<h2 class="anchored" data-anchor-id="synthetic-data-evaluation">Synthetic data evaluation</h2>
<p>Evaluating the quality of synthetic data is essential to ensure its reliability for further analyses. After generating synthetic data, it’s critical to compare its distributions and relationships between the variables to those in the original data set. The goal is to assess how closely the synthetic data mimics the statistical properties of the real data.</p>
<section id="compare-function" class="level3">
<h3 class="anchored" data-anchor-id="compare-function">Compare() function</h3>
<p>For the initial quality check, we utilize the <code>compare()</code> function from the <code>synthpop</code> package. This function allows for a side-by-side statistical comparison between the synthetic and original data. By setting the stat parameter to “counts,” we obtain a count-based statistical summary for each selected variable. This is a valuable first step for gauging how well the synthetic data set replicates the distribution of these variables in the original data set.</p>
</section>
</section>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the compare() function from the synthpop package to compare the target variables from the synthetic and real data sets</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>real_data_subset <span class="ot">&lt;-</span> real_data[, <span class="fu">c</span>(<span class="st">"BM"</span>, <span class="st">"FER"</span>, <span class="st">"FE"</span>, <span class="st">"TSAT"</span>, <span class="st">"TRANS"</span>, <span class="st">"AHBM"</span>)]</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>synth_data_subset <span class="ot">&lt;-</span> synth_data[, <span class="fu">c</span>(<span class="st">"BM"</span>, <span class="st">"FER"</span>, <span class="st">"FE"</span>, <span class="st">"TSAT"</span>, <span class="st">"TRANS"</span>, <span class="st">"AHBM"</span>)]</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(synth_data_subset, real_data_subset, <span class="at">stat =</span> <span class="st">"counts"</span>) <span class="co"># The stat parameter is set to "counts" to get count-based statistics for each variable in the selected subsets</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Comparing counts observed with synthetic</code></pre>
</div>
<div class="cell-output-display">
<p><img src="Hbmass_synthetic_final_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Press return for next variable(s): </code></pre>
</div>
<div class="cell-output-display">
<p><img src="Hbmass_synthetic_final_files/figure-html/unnamed-chunk-15-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Selected utility measures:
          pMSE   S_pMSE df
BM    0.000562 0.799911  4
FER   0.000283 0.402618  4
FE    0.000289 0.412111  4
TSAT  0.001189 1.692725  4
TRANS 0.001268 1.804945  4
AHBM  0.000163 0.231955  4</code></pre>
</div>
</div>
<div class="justify">
<p>The output from the <code>compare()</code> function provides utility measures, such as pMSE (Propensity Score Mean Squared Error) and S_pMSE (Scaled Propensity Score Mean Squared Error). These metrics evaluate the quality of the synthetic data when compared to the original data.</p>
<p>pMSE: This measure quantifies how well the synthetic data reproduces the relationships between variables found in the real data. Lower pMSE values suggest a better approximation, meaning that the fit of the models on the real and synthetic data is similar. All the variables in our case have pMSE values close to zero, which is a positive indication of the quality of the synthetic data.</p>
<p>S_pMSE: This is the pMSE divided by a scale factor, often the mean squared error of the model fit to the real data. It offers a relative measure of fit; lower S_pMSE values generally indicate better approximation quality. In our case, the S_pMSE values for all variables are low, reinforcing the quality of the synthetic data.</p>
<p>df: This represents the degrees of freedom for the statistical tests comparing the real and synthetic data. Here, it’s 4 for all variables. A higher number of degrees of freedom usually signifies a more flexible model, but it can also risk overfitting.</p>
<p>In summary, both the pMSE and S_pMSE values for all variables are low, indicating that the synthetic data closely mimics the relationships between variables in the original data.</p>
<section id="visual-comparison" class="level3">
<h3 class="anchored" data-anchor-id="visual-comparison">Visual Comparison</h3>
<p>We can also visualize the distributions of the target variables from both the real and synthetic data sets for a more intuitive comparison. By examining these histograms, we can get a visual sense of how closely the synthetic data approximates the real data set.</p>
</section>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize both real and synthetic data for comparison</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame to store variable names and bin widths</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>cont_var_distrib <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">var =</span> <span class="fu">c</span>(<span class="st">"BM"</span>, <span class="st">"FER"</span>, <span class="st">"FE"</span>, <span class="st">"TSAT"</span>, <span class="st">"TRANS"</span>, <span class="st">"AHBM"</span>, <span class="st">"RHBM"</span>),</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">bin_width =</span> <span class="fu">c</span>(<span class="fl">1.5</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="fl">0.1</span>, <span class="dv">25</span>, <span class="fl">0.2</span>)</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through the data frame to create plots</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(cont_var_distrib)) {</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>  var_name <span class="ot">&lt;-</span> <span class="fu">as.character</span>(cont_var_distrib[i, <span class="st">"var"</span>])</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>  bin_w <span class="ot">&lt;-</span> cont_var_distrib[i, <span class="st">"bin_width"</span>]</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">data =</span> real_data, <span class="fu">aes_string</span>(<span class="at">x =</span> var_name), <span class="at">binwidth =</span> bin_w, <span class="at">fill =</span> <span class="st">"blue"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">position =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">data =</span> synth_data, <span class="fu">aes_string</span>(<span class="at">x =</span> var_name), <span class="at">binwidth =</span> bin_w, <span class="at">fill =</span> <span class="st">"red"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">position =</span> <span class="st">"identity"</span>) <span class="sc">+</span> </span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Distribution of"</span>, var_name, <span class="st">": Real (Blue) vs. Synthetic (Red)"</span>))</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(p)</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Hbmass_synthetic_final_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Hbmass_synthetic_final_files/figure-html/unnamed-chunk-16-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Hbmass_synthetic_final_files/figure-html/unnamed-chunk-16-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Hbmass_synthetic_final_files/figure-html/unnamed-chunk-16-4.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Hbmass_synthetic_final_files/figure-html/unnamed-chunk-16-5.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Hbmass_synthetic_final_files/figure-html/unnamed-chunk-16-6.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Hbmass_synthetic_final_files/figure-html/unnamed-chunk-16-7.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="descriptive-statistics" class="level3 justify">
<h3 class="anchored" data-anchor-id="descriptive-statistics">Descriptive statistics</h3>
<p>The <strong><code>summary()</code></strong> function provides a convenient way for quickly reviewing and comparing the descriptive statistics of both the synthetic and real data sets. With this function we can obtain key summary metrics like mean, median, and quartiles.</p>
</section>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare descriptive statistics of the real and synthetic data sets</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(real_data[, cont_var_distrib<span class="sc">$</span>var])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       BM            FER               FE             TSAT      
 Min.   :47.0   Min.   : 11.80   Min.   : 5.80   Min.   : 3.10  
 1st Qu.:59.0   1st Qu.: 41.88   1st Qu.:14.40   1st Qu.:19.00  
 Median :65.7   Median : 63.30   Median :17.90   Median :25.00  
 Mean   :66.4   Mean   : 73.15   Mean   :20.06   Mean   :27.26  
 3rd Qu.:73.0   3rd Qu.: 96.75   3rd Qu.:25.00   3rd Qu.:33.00  
 Max.   :97.4   Max.   :227.80   Max.   :78.30   Max.   :88.00  
     TRANS            AHBM             RHBM      
 Min.   :1.300   Min.   : 478.0   Min.   : 8.20  
 1st Qu.:2.500   1st Qu.: 700.8   1st Qu.:11.50  
 Median :2.800   Median : 848.5   Median :13.20  
 Mean   :2.819   Mean   : 857.6   Mean   :12.88  
 3rd Qu.:3.100   3rd Qu.: 977.2   3rd Qu.:14.40  
 Max.   :4.400   Max.   :1424.0   Max.   :17.10  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(synth_data[, cont_var_distrib<span class="sc">$</span>var])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       BM             FER               FE             TSAT      
 Min.   :47.00   Min.   : 12.30   Min.   : 5.80   Min.   : 9.00  
 1st Qu.:59.00   1st Qu.: 43.38   1st Qu.:14.50   1st Qu.:19.00  
 Median :66.20   Median : 61.85   Median :18.20   Median :26.00  
 Mean   :66.75   Mean   : 71.40   Mean   :20.33   Mean   :27.08  
 3rd Qu.:73.10   3rd Qu.: 92.83   3rd Qu.:25.40   3rd Qu.:32.00  
 Max.   :97.40   Max.   :227.80   Max.   :78.30   Max.   :88.00  
     TRANS            AHBM             RHBM       
 Min.   :1.300   Min.   : 478.0   Min.   : 7.979  
 1st Qu.:2.500   1st Qu.: 700.8   1st Qu.:11.493  
 Median :2.700   Median : 861.5   Median :13.031  
 Mean   :2.802   Mean   : 861.8   Mean   :12.880  
 3rd Qu.:3.100   3rd Qu.: 978.0   3rd Qu.:14.352  
 Max.   :4.100   Max.   :1424.0   Max.   :17.526  </code></pre>
</div>
</div>
<div class="justify">
<p>The descriptive statistics of the real and synthetic data show close alignment across all key metrics including minima, maxima, quartiles, median, and mean for each variable. This indicates that the synthetic data is a reliable approximation of the real data, effectively capturing its range, spread, and central tendencies.</p>
<section id="statistical-comparison-kolmogorov-smirnov-test" class="level3">
<h3 class="anchored" data-anchor-id="statistical-comparison-kolmogorov-smirnov-test">Statistical comparison: Kolmogorov-Smirnov test</h3>
<p>To further ensure that synthetic data closely resembles the original data, it’s crucial to compare their distributions more quantitatively. The Kolmogorov-Smirnov (K-S) test is a non-parametric test that gauges if two data sets come from the same distribution. The K-S test yields two main metrics: the D-statistic and the p-value. The D-statistic measures the maximum difference between the cumulative distributions of the data sets; a smaller D-value suggests the data sets are similar. The p-value, on the other hand, gives us the probability that the observed differences could occur by random chance. A high p-value (usually above 0.05) indicates that the data sets are statistically similar, while a low p-value suggests they are different.</p>
</section>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize an empty data frame to store the results of the K-S test</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>ks_results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Variable =</span> <span class="fu">character</span>(<span class="dv">0</span>),</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">D_statistic =</span> <span class="fu">numeric</span>(<span class="dv">0</span>),</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">p_value =</span> <span class="fu">numeric</span>(<span class="dv">0</span>)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through each variable in the 'var' column of 'cont_var_distrib' to perform the K-S test</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (var <span class="cf">in</span> cont_var_distrib<span class="sc">$</span>var) {</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Run the K-S test on each variable and store the results in 'ks_test_result'</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>  ks_test_result <span class="ot">&lt;-</span> <span class="fu">ks.test</span>(real_data[[var]], synth_data[[var]])</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add the results (Variable name, D-statistic, and p-value) to the 'ks_results' data frame</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>  ks_results <span class="ot">&lt;-</span> <span class="fu">rbind</span>(ks_results, <span class="fu">data.frame</span>(</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">Variable =</span> var,</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">D_statistic =</span> ks_test_result<span class="sc">$</span>statistic,</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">p_value =</span> ks_test_result<span class="sc">$</span>p.value</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the K-S test results</span></span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ks_results, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Variable D_statistic   p_value
       BM  0.04494382 0.8647785
      FER  0.03651685 0.9715491
       FE  0.04494382 0.8647785
     TSAT  0.04213483 0.9100993
    TRANS  0.04213483 0.9100993
     AHBM  0.02247191 0.9999908
     RHBM  0.03370787 0.9874983</code></pre>
</div>
</div>
<div class="justify">
<p>The K-S test results show low D-statistic values and high p-values for all variables, suggesting that the distributions of the synthetic and real data are not significantly different. This further reinforces the conclusion that the synthetic data closely approximates the real data across all examined variables.</p>
<section id="correlation-structure" class="level3">
<h3 class="anchored" data-anchor-id="correlation-structure">Correlation structure</h3>
<p>To evaluate the integrity of the relationships between variables in synthetic data, it’s crucial to assess whether it maintains the original data’s correlation structure. Correlation matrices are instrumental for this. Each matrix is filled with correlation coefficients that range from -1 to 1. The diagonal always contains 1s, as each variable is perfectly correlated with itself. Off-diagonal values indicate the strength and direction of the relationship between variable pairs. A value close to 1 indicates a strong positive correlation, while a value near -1 suggests a strong negative correlation. A value of 0 indicates no correlation. By comparing the correlation matrices of the real and synthetic data sets, one can visually gauge how well the synthetic data captures these relationships between variables. We visualize these using correlation plots, where circle size and color represent the strength and direction of the correlation, respectively.</p>
</section>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the synthetic data maintains the correlation structure of the original data</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract relevant variable names from cont_var_distrib DataFrame</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>selected_vars <span class="ot">&lt;-</span> <span class="fu">as.character</span>(cont_var_distrib<span class="sc">$</span>var)</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter the original dataset to include only the selected variables</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>real_data_selected <span class="ot">&lt;-</span> real_data[, selected_vars]</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute correlation matrices</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>cor_real_selected <span class="ot">&lt;-</span> <span class="fu">cor</span>(real_data_selected, <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>cor_synthetic_selected <span class="ot">&lt;-</span> <span class="fu">cor</span>(synth_data[, selected_vars], <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Display correlation matrices</span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cor_real_selected)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               BM          FER           FE        TSAT      TRANS        AHBM
BM     1.00000000  0.248379284 -0.082991361 -0.07177236 -0.2902034  0.73880524
FER    0.24837928  1.000000000  0.009181825  0.15808523 -0.3080575  0.36813084
FE    -0.08299136  0.009181825  1.000000000  0.68396109  0.1524052 -0.11787730
TSAT  -0.07177236  0.158085229  0.683961088  1.00000000 -0.2273167  0.03165077
TRANS -0.29020343 -0.308057485  0.152405195 -0.22731671  1.0000000 -0.44334379
AHBM   0.73880524  0.368130837 -0.117877297  0.03165077 -0.4433438  1.00000000
RHBM   0.12315559  0.305115203 -0.074619029  0.12357335 -0.3628340  0.75064859
             RHBM
BM     0.12315559
FER    0.30511520
FE    -0.07461903
TSAT   0.12357335
TRANS -0.36283398
AHBM   0.75064859
RHBM   1.00000000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cor_synthetic_selected)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               BM          FER           FE        TSAT       TRANS        AHBM
BM     1.00000000  0.307436090 -0.084686212 -0.03287345 -0.28138951  0.74132500
FER    0.30743609  1.000000000 -0.004058385  0.15571628 -0.32846221  0.36566651
FE    -0.08468621 -0.004058385  1.000000000  0.67620481  0.19452156 -0.13821773
TSAT  -0.03287345  0.155716280  0.676204810  1.00000000 -0.08449261 -0.01993178
TRANS -0.28138951 -0.328462211  0.194521558 -0.08449261  1.00000000 -0.37810366
AHBM   0.74132500  0.365666514 -0.138217732 -0.01993178 -0.37810366  1.00000000
RHBM   0.11192386  0.245132347 -0.102013477  0.02131233 -0.27636855  0.74114184
             RHBM
BM     0.11192386
FER    0.24513235
FE    -0.10201348
TSAT   0.02131233
TRANS -0.27636855
AHBM   0.74114184
RHBM   1.00000000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize correlation matrices</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Original data correlations</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(cor_real_selected, <span class="at">title =</span> <span class="st">"Real Data Correlations"</span>, <span class="at">method =</span> <span class="st">"circle"</span>, <span class="at">diag =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Hbmass_synthetic_final_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Synthetic data correlations</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(cor_synthetic_selected, <span class="at">title =</span> <span class="st">"Synthetic Data Correlations"</span>, <span class="at">method =</span> <span class="st">"circle"</span>, <span class="at">diag =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Hbmass_synthetic_final_files/figure-html/unnamed-chunk-19-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="justify">
<p>The correlation matrices for both real and synthetic data show similar patterns across variables, although some minor differences exist in terms of correlation strength magnitudes. Overall, the matrices broadly align, suggesting that the synthetic data maintains the relational structures observed in the original data set. Thus, the synthetic data appears to be a reliable representation of the real data in terms of correlations between the variables.</p>
<section id="model-based-evaluation" class="level3">
<h3 class="anchored" data-anchor-id="model-based-evaluation">Model-based evaluation</h3>
<p>To evaluate how well synthetic data approximates real data, we conduct a model-based evaluation. We train a predictive model on the synthetic data and then test its accuracy on a validation set made up of real data. We measure the model’s performance using Mean Squared Error (MSE). We also train a model using real data and compare the MSEs of both models. If the MSEs are similar, it suggests that the synthetic data has captured the essential characteristics of the original data, making it a viable substitute for predictive modelling tasks.</p>
</section>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Train a model on the synthetic data and test it on a real validation set to see how well it generalizes </span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize an empty data frame to store MSE results</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>mse_results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">var =</span> <span class="fu">character</span>(),</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">mse_real =</span> <span class="fu">numeric</span>(),</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">mse_synthetic =</span> <span class="fu">numeric</span>())</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Randomly split the original data into 80% training and 20% test sets</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(my_seed)</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>train_indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(real_data), <span class="fu">nrow</span>(real_data)<span class="sc">*</span><span class="fl">0.8</span>)</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> real_data[train_indices, ]</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> real_data[<span class="sc">-</span>train_indices, ]</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through each variable in cont_var_distrib</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (var_name <span class="cf">in</span> cont_var_distrib<span class="sc">$</span>var) {</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Train a linear regression model using the synthetic data</span></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>  model_synthetic <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">as.formula</span>(<span class="fu">paste</span>(var_name, <span class="st">"~ ."</span>)), <span class="at">data =</span> synth_data)</span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Train a linear regression model using the real training data</span></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>  model_real <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">as.formula</span>(<span class="fu">paste</span>(var_name, <span class="st">"~ ."</span>)), <span class="at">data =</span> train_data)</span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make predictions using the test set for both models</span></span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>  predictions_synthetic <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_synthetic, <span class="at">newdata =</span> test_data)</span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>  predictions_real <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_real, <span class="at">newdata =</span> test_data)</span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate MSE for the models trained on synthetic and real data</span></span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>  mse_synthetic <span class="ot">&lt;-</span> <span class="fu">mean</span>((test_data[[var_name]] <span class="sc">-</span> predictions_synthetic)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a>  mse_real <span class="ot">&lt;-</span> <span class="fu">mean</span>((test_data[[var_name]] <span class="sc">-</span> predictions_real)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Append MSE results to the mse_results data frame</span></span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a>  mse_results <span class="ot">&lt;-</span> <span class="fu">rbind</span>(mse_results, <span class="fu">data.frame</span>(<span class="at">var =</span> var_name, <span class="at">mse_real =</span> mse_real, <span class="at">mse_synthetic =</span> mse_synthetic))</span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-34"><a href="#cb57-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the mse_results data frame for comparison</span></span>
<span id="cb57-35"><a href="#cb57-35" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(mse_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    var    mse_real mse_synthetic
1    BM   3.2272030     3.0783995
2   FER 682.6755342   709.2372916
3    FE  23.1097343    24.2530100
4  TSAT  42.8362502    37.4551828
5 TRANS   0.1363852     0.1549053
6  AHBM 492.0450698   467.7665640
7  RHBM   0.1077625     0.1050816</code></pre>
</div>
</div>
<div class="justify">
<p>The model-based evaluation shows that the Mean Squared Errors (MSEs) between models trained on real and synthetic data are relatively close for all variables. This suggests that the synthetic data captures the essential characteristics of the real data quite well, making it a reliable substitute for predictive modeling tasks. Overall, the synthetic data appears to be a viable alternative to the original data for building and testing predictive models.</p>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>Utility is High: The low pMSE and S_pMSE values confirm that the synthetic data effectively replicates the underlying relationships in the original data.</p>
<p>Distribution Similarity is Robust: High p-values from the Kolmogorov-Smirnov test indicate that the synthetic data’s distribution is closely aligned with that of the real data.</p>
<p>Correlations are Preserved: The correlation matrices for both real and synthetic data are largely consistent, showing that relational structures are maintained.</p>
<p>Model-Based Evaluations are Aligned: Close Mean Squared Errors between the synthetic and real data imply comparable predictive accuracy, further confirming the utility of the synthetic data.</p>
<p>In summary, the synthetic data demonstrates high fidelity to the original data set across multiple dimensions: utility, distribution similarity, correlation preservation, and predictive performance. Therefore, the synthetic data can be considered a reliable and high-quality representation of the original data set.</p>
</section>
<section id="saving-synthetic-data-to-a-file" class="level2">
<h2 class="anchored" data-anchor-id="saving-synthetic-data-to-a-file">Saving synthetic data to a file</h2>
</section>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># write.csv(synth_data, "Hbmass_synthetic.csv", row.names = FALSE)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>